<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HTMX Asset Price List Example</title>
    <script src="https://unpkg.com/htmx.org"></script>
</head>
<body>

<h2>Asset Price List</h2>

<!-- Trigger a GET request on page load and display the result in this div -->
<div hx-get="https://dev-api.ainsliebullion.com.au/assets/pricelist"
     hx-trigger="load"
     hx-target="#price-list"
     hx-swap="innerHTML">
    Loading price list...
</div>

<!-- Placeholder for the API response -->
<div id="price-list"></div>

<script>
document.body.addEventListener('htmx:afterSwap', function(event) {
    if (event.target.id === 'price-list') {
        // Assuming the API returns JSON, parse the response and format it for display
        try {
            const jsonResponse = JSON.parse(event.detail.xhr.response);
            const formattedHtml = formatJsonToHtml(jsonResponse);
            event.target.innerHTML = formattedHtml;
        } catch (error) {
            console.error('Error parsing JSON response:', error);
            event.target.innerHTML = '<p>Error loading price list.</p>';
        }
    }
});

function formatJsonToHtml(json) {
    // This function takes JSON data and converts it to HTML
    // Adjust this to match the structure of your API's response
    let html = '<ul>';
    if (json && Array.isArray(json.data)) {
        json.data.forEach(item => {
            html += `<li>${item.asset}: $${item.price}</li>`;
        });
    } else {
        html += '<li>No data found</li>';
    }
    html += '</ul>';
    return html;
}
</script>

</body>
</html>
